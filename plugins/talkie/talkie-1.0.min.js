(function(){function e(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+n]=n}function t(){this.animations=[]}function n(e,t,n,a){n===void 0&&(n=0),i(e);var r=e.node().__kiln_transitions__,s=e.transition().duration(Talkie.fast_forward?0:n);return a&&s.ease(a),{attr:function(e,t){r.push(["attr",e,t]),s.attr(e,t)},style:function(e,t){r.push(["style",e,t]),s.style(e,t)},text:function(e){r.push(["text",e]),s.text(e)},attrInterpolateString:function(e,t,n){r.push(["attr",e,n]),s.attrTween(e,function(){return d3.interpolateString(t,n)})}}}function i(e){e.transition().duration(0);var t=e.node(),n=t.__kiln_transitions__;if(n){for(var i=0;n.length>i;i++){var a=n[i],r=a[0],s=a[1],l=a[2];e[r](s,l)}n.length=0}else t.__kiln_transitions__=[]}function a(e){e===void 0&&(e=document),this._root=d3.select(e)}function r(e,t){this.animate=e,this.element=t}function s(e){if("string"==typeof e){var t=e.match(/^(\d+):(\d+(?:\.\d+)?)$/);if(t)return 60*parseInt(t[1])+parseFloat(t[2])}return parseFloat(e)}function l(e,t){if("function"==typeof e)e.call(t);else if("[object Array]"===Object.prototype.toString.call(e))for(var n=0;e.length>n;n++)l(e[n],t);else e.run(t)}function o(e){for(var t=Object.keys(e),n=t.map(s),i={},a=0;n.length>a;a++)i[n[a]]=e[t[a]];n.sort(function(e,t){return e-t});for(var r=[],a=0;n.length>a;a++){var l=n[a];r.push([l,i[l]])}return r}Talkie={version:"1.0.4"};var c=Talkie.warn=function(){console&&console.log&&(console.log.apply?console.log.apply(console,arguments):console.log(Array.prototype.slice.call(arguments,0)))};Talkie.extend=function(e){for(var t in e)if(e.hasOwnProperty(t)){if(Talkie.hasOwnProperty(t)){c("Refusing to override Talkie."+t);continue}Talkie[t]=e[t]}},Talkie.element=function(e){return"string"==typeof e?document.querySelector(e):e},Talkie.getStyle=function(e,t){return e.currentStyle?e.currentStyle[t]:document.defaultView.getComputedStyle(e,null).getPropertyValue(t)},Talkie.preventDefault=function(e){window.event&&event.preventDefault?event.preventDefault():e.preventDefault?e.preventDefault():event.returnValue=!1},Talkie.addEventListener=function(t,n,i){if("string"==typeof t)for(var a=document.querySelectorAll(t),r=0;a.length>r;r++){var s=a[r];e(s,n,i)}else e(t,n,i)},Talkie.fireEvent=function(e,t,n){var i;if(document.createEvent?(i=document.createEvent("HTMLEvents"),i.initEvent(e,!0,!0)):document.createEventObject&&(i=document.createEventObject(),i.eventType=e),n)for(var a in n)n.hasOwnProperty(a)&&(i[a]=n[a]);t.dispatchEvent?t.dispatchEvent(i):t.fireEvent&&t.fireEvent("on"+i.eventType,i)},Talkie.ui={version:"1.0"},Talkie.ui.playButton=function(e,t){var n=Talkie.element(e),i=document.createElement("div");i.className="talkie-play-button","relative"!==Talkie.getStyle(n,"position")&&(n.style.position="relative"),n.appendChild(i),i.style.left=(n.offsetWidth-i.offsetWidth)/2+"px",i.style.top=(n.offsetHeight-i.offsetHeight)/2+"px",Talkie.addEventListener(i,"click",function(){t.play()}),t.onPlay(function(){try{n.removeChild(i)}catch(e){}})};var p=function(e,t){var n=Talkie.element(t);if(n){var i=n.getAttribute("data-talkie-panel-index");this.animations=[[function(t){var n=e.selected_panel;e._selectPanel(i),t.setUndo(function(){e._selectPanel(n)})}]]}};p.prototype=new t;var u=function(e){var t=Talkie.element(e);t.classList?t.classList.contains("talkie-slider")||t.classList.add("talkie-slider"):t.className.match(/\btalkie-slider\b/)||(t.className+=" talkie-slider"),this.arrow_prev=t.getElementsByClassName("talkie-slider-arrowprev")[0],this.arrow_next=t.getElementsByClassName("talkie-slider-arrownext")[0],this.frame=document.createElement("div"),this.frame.className="talkie-slider-frame",t.appendChild(this.frame),this.panels=document.createElement("div"),this.panels.className="talkie-slider-panels",this.frame.appendChild(this.panels),this.panel_elements=t.querySelectorAll(".talkie-slider-panel"),this.num_panels=this.panel_elements.length;for(var n=0;this.panel_elements.length>n;n++){var i=this.panel_elements[n];this.panels.appendChild(i),i.style.width=this.frame.offsetWidth+"px",i.setAttribute("data-talkie-panel-index",n)}d3&&d3.select(this.panels).selectAll(".talkie-slider-panel").data(d3.range(this.num_panels));var a=t.querySelector(".talkie-slider-nav");a&&this.navigation(a),this._panelChanged(0);var r=this;this.arrow_next&&(t.appendChild(this.arrow_next),this.arrow_next.style.top=(t.offsetHeight-this.arrow_next.offsetHeight)/2+"px",Talkie.addEventListener(this.arrow_next,"click",function(e){Talkie.preventDefault(e),r._selectNextPanel()})),this.arrow_prev&&(t.appendChild(this.arrow_prev),this.arrow_prev.style.top=(t.offsetHeight-this.arrow_prev.offsetHeight)/2+"px",Talkie.addEventListener(this.arrow_prev,"click",function(e){Talkie.preventDefault(e),r._selectPreviousPanel()}))};u.prototype.navigation=function(e){var t=this,n=Talkie.element(e);if(d3){var i=d3.select(n);i.classed("talkie-slider-nav",!0),i.selectAll(".talkie-slider-nav-dot").data(d3.range(this.num_panels)).enter().append("div").attr("class","talkie-slider-nav-dot"),this.navdots=i.selectAll(".talkie-slider-nav-dot"),this.navdots.on("click",function(e){return t._selectPanel(e,!0),!1}),this._markSelectedNavDot()}return this},u.prototype.panel=function(e){return new p(this,e)},u.prototype.slideTo=function(e){this._selectPanelByElement(Talkie.element(e))},u.prototype._panelChanged=function(e,t){var n=this.selected_panel;this.selected_panel=e,d3?(d3.select(this.panels).transition().duration(500).style("margin-left",-this.frame.clientWidth*this.selected_panel+"px"),this.arrow_prev&&d3.select(this.arrow_prev).transition().duration(500).style("opacity",0==this.selected_panel?0:1),this.arrow_next&&d3.select(this.arrow_next).transition().duration(500).style("opacity",this.selected_panel==this.num_panels-1?0:1)):(this.panels.style.marginLeft=-this.frame.clientWidth*this.selected_panel+"px",this.arrow_prev&&(0==this.selected_panel?(this.arrow_prev.style.opacity=1,this.arrow_prev.style.visibility="hidden"):this.arrow_prev.style.visibility="visible"),this.arrow_next&&(this.arrow_next.style.visibility=this.selected_panel==this.num_panels-1?"hidden":"visible")),this._markSelectedNavDot(),Talkie.fireEvent("Talkie.slider.load",this.panel_elements[this.selected_panel],{explicitly:t,fromPanel:this.panel_elements[n],toPanel:this.panel_elements[this.selected_panel],slider:this})},u.prototype._markSelectedNavDot=function(){if(this.navdots){var e=this;this.navdots.classed("talkie-slider-nav-dot-selected",function(t,n){return n==e.selected_panel})}},u.prototype._selectPanel=function(e,t){this._panelChanged(e,t)},u.prototype._selectPanelByElement=function(e){e&&this._panelChanged(e.getAttribute("data-talkie-panel-index"))},u.prototype._selectNextPanel=function(){this.selected_panel!=this.num_panels-1&&this._panelChanged(this.selected_panel+1,!0)},u.prototype._selectPreviousPanel=function(){0!=this.selected_panel&&this._panelChanged(this.selected_panel-1,!0)},Talkie.slider=function(e){return new u(e)};var h=function(e){if(!e.getAttribute("data-talkie-madeAbsolute")){e.setAttribute("data-talkie-madeAbsolute",!0);for(var t,n,i,a,r,s,l=e.pathSegList,o=0,c=0,p=0,u=l.numberOfItems;u>p;++p){var h=l.getItem(p),d=h.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(d))"x"in h&&(o=h.x),"y"in h&&(c=h.y);else switch("x1"in h&&(i=o+h.x1),"x2"in h&&(r=o+h.x2),"y1"in h&&(a=c+h.y1),"y2"in h&&(s=c+h.y2),"x"in h&&(o+=h.x),"y"in h&&(c+=h.y),d){case"m":l.replaceItem(e.createSVGPathSegMovetoAbs(o,c),p);break;case"l":l.replaceItem(e.createSVGPathSegLinetoAbs(o,c),p);break;case"h":l.replaceItem(e.createSVGPathSegLinetoHorizontalAbs(o),p);break;case"v":l.replaceItem(e.createSVGPathSegLinetoVerticalAbs(c),p);break;case"c":l.replaceItem(e.createSVGPathSegCurvetoCubicAbs(o,c,i,a,r,s),p);break;case"s":l.replaceItem(e.createSVGPathSegCurvetoCubicSmoothAbs(o,c,r,s),p);break;case"q":l.replaceItem(e.createSVGPathSegCurvetoQuadraticAbs(o,c,i,a),p);break;case"t":l.replaceItem(e.createSVGPathSegCurvetoQuadraticSmoothAbs(o,c),p);break;case"a":l.replaceItem(e.createSVGPathSegArcAbs(o,c,h.r1,h.r2,h.angle,h.largeArcFlag,h.sweepFlag),p);break;case"z":case"Z":o=t,c=n}("M"==d||"m"==d)&&(t=o,n=c)}}},d=function(e){if(!e.empty()){var t=e.node();"path"===t.nodeName&&h(t)}};t.prototype.clone=function(){var e=new t;return e.animations=this.animations.slice(0),e},t.prototype.pushAnimation=function(e,t){var n=this.clone();return n.animations.push([e,t]),n},t.prototype.and=function(e){function t(e,t){"function"==typeof t?t.call(e):t.run(e)}return this.pushAnimation(t,e)},t.prototype.run=function(e){e||(e={setUndo:function(){}});for(var t=0;this.animations.length>t;t++){var n=this.animations[t],i=n[0],a=n[1];i.call(this,e,a)}},Talkie.animate=function(e){return new a(e)};var f=[];a.prototype._element=function(e){if(e instanceof window.Element)return d3.select(e);var t=this._root.select(e);return t.empty()&&Talkie.warn("Selector does not match anything: "+e+" in "+this._root),t},a.prototype.raw=function(){return this._root},f.push("text"),a.prototype.text=function(e,t,a,r,s){var l=n(e,t,r,s),o=e.text();return l.text(a),t.setUndo(function(){i(e),e.text(o)}),this},f.push("attr"),a.prototype.attr=function(e,t,a,r,s,l){var o=n(e,t,s,l),c=e.attr(a);return o.attr(a,r),t.setUndo(function(){i(e),e.attr(a,c)}),this},f.push("morphTo");var v={circle:["cx","cy","r"],path:["d"],line:["x1","y1","x2","y2"]};a.prototype.morphTo=function(e,t,a,r,s){d(e);var l=this._element(a);if(!l.empty()){d(l);var o=n(e,t,r,s),c=[],p=v[l.node().nodeName];if(!p)return Talkie.warn("Talkie doesnâ€™t know how to morph a "+l.node().nodeName+" element"),void 0;for(var u=0;p.length>u;u++){var h=p[u];c.push(e.attr(h)),o.attr(h,l.attr(h))}return t.setUndo(function(){i(e);for(var t=0;p.length>t;t++)e.attr(p[t],c[t])}),this}},a.prototype._style_single=function(e,t,a,r,s,l){var o=n(e,t,s,l),c=e.style(a);return o.style(a,r),t.setUndo(function(){i(e),e.style(a,c)}),this},a.prototype._style_multi=function(e,t,a,r,s){var l=n(e,t,r,s),o={};for(var c in a)a.hasOwnProperty(c)&&(o[c]=e.style(c),l.style(c,a[c]));return t.setUndo(function(){i(e);for(var t in a)a.hasOwnProperty(t)&&e.style(t,o[t])}),this},f.push("style"),a.prototype.style=function(e,t,n){return"string"==typeof n?this._style_single.apply(this,arguments):this._style_multi.apply(this,arguments)},a.prototype.select=function(e){var t=this._element(e);return new r(this,t)},r.prototype=new t,r.prototype.clone=function(){var e=new r(this.animate,this.element);return e.animations=this.animations.slice(0),e};for(var m=0;f.length>m;m++)(function(e){r.prototype[e]=function(){return this.element.empty()?this:this.pushAnimation(function(t,n){this.animate[e].apply(this.animate,[this.element,t].concat(n))},Array.prototype.slice.call(arguments,0))}})(f[m]);if(Talkie.timeline=function(e,t){e=Talkie.element(e);var n,i=[],a=-1,r=!1,s={rewind:function(){e.readyState>=1&&(i=[],a=-1,e.pause(),e.currentTime=0)},setUndo:function(e){return this.undoing?(Talkie.warn("Ignoring setUndo: we are already undoing"),void 0):(i.push([n,e,a]),void 0)},undoInteraction:function(e){return this.undoing?(Talkie.warn("Ignoring undoInteraction: we are already undoing"),void 0):(i.push([1/0,e,a]),void 0)},play:function(){e.play()},pause:function(){e.pause(),r=!0},onPlay:function(t){e.addEventListener("play",t,!1)}},c=o(t);return e.addEventListener("timeupdate",function(){if(r)return r=!1,void 0;for(s.undoing=!0;i.length>0&&i[i.length-1][0]>this.currentTime;){var e=i.pop();e[1].call(s),a=e[2]}s.undoing=!1;for(var t=a+1;c.length>t&&c[t][0]<=this.currentTime;t++)s.fast_forward=c.length>t+1&&c[t+1][0]<=this.currentTime,n=c[t][0],l(c[t][1],s),a=t},!1),s},window.jQuery){var y={animate:function(e){var t=e.get(0);return Talkie.animate(t.ownerDocument).select(t)}},_={timeline:function(e,t){var n=Talkie.timeline(e,t);jQuery(e).data("_talkie_timeline",n)}};jQuery.fn.talkie=function(e){var t=Array.prototype.slice.call(arguments,1),n=y[e];return n?n.apply(window,[this].concat(t)):(n=_[e],n===void 0?(Talkie.warn("No such command: "+e),this):this.each(function(){n.apply(window,[this].concat(t))}))}}})();